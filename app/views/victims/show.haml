.navigation
  %ul
    %li= link_to 'Back', :back
    - if editable?
      %li= link_to 'Edit', edit_victim_path(:id => @victim.to_param)
      %li= link_to 'Delete', victim_path(:id => @victim.to_param), :method => :delete, :confirm => "Are you really sure?"
    - if @victim.displayable?
      %li
        Download
        = link_to 'CSV', download_path(:id => @victim.to_param, :format => "csv")
        = link_to 'JSON', download_path(:id => @victim.to_param, :format => "json")
        = link_to 'XML', download_path(:id => @victim.to_param, :format => "xml")

  %h2= "#{@victim.name} - #{@victim.type.to_s.titleize}"

  %table
    %tr
      %td Last visited
      %td
        - unless @victim.visited?
          %span Unvisited
        - else
          = @victim.last_visit.to_s
    %tr
      %td Visit Interval
      %td= @victim.interval
    %tr
      %td Victim URL
      %td= @victim.url
    %tr
      %td CSS Selector
      %td "$('#{@victim.selector}')"
    %tr
      %td Successful Visits
      %td= @victim.successful_visits.count
    %tr
      %td Failed Visits
      %td= @victim.unsuccessful_visits.count

- if @victim.displayable?
  #tables
    .table
      %table
        %tr
          %th Date
          %th Data

        - @victim.successful_visits.each do |visit|
          %tr
            %td= pretty_time visit.created_at
            %td= visit.value.to_i
    .clear
  
  #graphs
    .graph
      .chart-container{ :data => data_array(@victim).to_json, :name => @victim.name }
        .chart

    .clear